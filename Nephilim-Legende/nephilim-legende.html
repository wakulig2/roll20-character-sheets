<!------------------------------------ Begin custom sheet here ------------------------------------------->
<!------------------------------------ Tabs for magical choices ------------------------------------------->
<div class="sheet-first-annonce">Le personnage pratique : </div>
<input type="checkbox" id="practice_magie" name="attr_practice_magie" class="sheet-checkbox-tab sheet-practice-mag"><label for="practice_magie" class="sheet-bla">La Magie</label>
<input type="checkbox" id="practice_kabb" name="attr_practice_kabb" class="sheet-checkbox-tab sheet-practice-kabb"><label for="practice_kabb" class="sheet-bla">La Kabbale</label>
<input type="checkbox" id="practice_alch" name="attr_practice_alch" class="sheet-checkbox-tab sheet-practice-alch"><label for="practice_alch" class="sheet-bla">L'Alchimie</label>

<div></div>
<!------------------------------------ Generic tabs ------------------------------------------->
<div class="sheet-first-annonce">Accès rapides : </div>
<input type="radio" name="attr_tab" class="sheet-tab sheet-tab1" value="1" checked="checked" /><span title="Nephilim"></span>
<input type="radio" name="attr_tab" class="sheet-tab sheet-tab2" value="2" /><span title="Incarnation"></span>
<input type="radio" name="attr_tab" class="sheet-tab sheet-tab3" value="3" /><span title="Materiel"></span>
<input type="radio" name="attr_tab" class="sheet-tab sheet-tab4 sheet-tab-optionnal sheet-tab-optionnal4" value="4" /><span class="sheet-tab-optionnal sheet-tab-optionnal4" title="Magie"></span>
<input type="radio" name="attr_tab" class="sheet-tab sheet-tab5 sheet-tab-optionnal sheet-tab-optionnal5" value="5" /><span class="sheet-tab-optionnal sheet-tab-optionnal5" title="Kabbale"></span>
<input type="radio" name="attr_tab" class="sheet-tab sheet-tab6 sheet-tab-optionnal sheet-tab-optionnal5" value="6" /><span class="sheet-tab-optionnal sheet-tab-optionnal5" title="Arbre de vie"></span>
<input type="radio" name="attr_tab" class="sheet-tab sheet-tab7 sheet-tab-optionnal sheet-tab-optionnal6" value="7" /><span class="sheet-tab-optionnal sheet-tab-optionnal6" title="Alchimie"></span>
<input type="radio" name="attr_tab" class="sheet-tab sheet-tab8 sheet-tab-optionnal sheet-tab-optionnal6" value="8" /><span class="sheet-tab-optionnal sheet-tab-optionnal6" title="Constructs"></span>
<input type="radio" name="attr_tab" class="sheet-tab sheet-tab9" value="9" /><span title="Fraternité"></span>



<div class="sheet-test"></div>


<!------------------------------------------- Page 1 - Nephilim ------------------------------------------->
<div class="sheet-tab-content sheet-tab1">
    <div class="sheet-main">

        <div class="sheet-box sheet-charact">
            <div class="sheet-attrib">
                <div class="sheet-bigtext">Nom : </div> <input type="text" name="attr_character_name" class="sheet-name" />
            </div>
            <div class="sheet-box sheet-attrib">
                <div class="sheet-bigtext">Métamorphe : </div> <input type="text" name="attr_metamorphose_name" title="Type de metamorphose" placeholder="Type de metamorphose" />

                <div class="sheet-bigtext withmarginbottom">Métamorphoses : </div><input type="number" class="sheet-carre" name="attr_metamorphe" />
                <fieldset class="repeating_metamorphose">
                    <input class="sheet-large" name="attr_metamorphose_desc" type="text" title="Description de la metamorphose" />
                    <label class="sheet-checkbox-label">
                        <input type="checkbox" name="attr_permanent" class="sheet-checkbox-check">
                        <i class="sheet-checkbox-img"></i>
                    </label>
                </fieldset>
            </div>
            <div class="sheet-main sheet-attrib">
                <textarea rows="3" name="attr_en_une_phrase" placeholder="Votre néphilim en quelques phrases....."></textarea>

            </div>
        </div>

        <div class="sheet-box sheet-elements">
            <div class="sheet-kafeu">
                <input class="sheet-rond sheet-ka" type="number" name="attr_kafeu" />
                <button type="roll" class="sheet-karoll" style="color:darkred" name="karollfeu" value="&{template:ka} {{perso= @{character_name} }} {{nom_ka=Ka Feu}} {{jet=[[ 1d100 ]] }}{{seuil=[[(?{Bonus / malus ?|0}[ Bonus, malus, vécus, etc. ]+@{kafeu}[ Ka feu ])*10 ]] }} ">Ka Feu</button>
            </div>

            <div class="sheet-kaair">
                <input class="sheet-rond sheet-ka" name="attr_kaair" type="number" />
                <button type="roll" class="sheet-karoll" style="color:darkblue" name="karollair" value="&{template:ka} {{perso= @{character_name} }} {{nom_ka=Ka Air}} {{jet=[[ 1d100 ]] }}{{seuil=[[(?{Bonus / malus ?|0}[ Bonus, malus, vécus, etc. ]+@{kaair}[ Ka air ])*10 ]] }} ">Ka Air</button>
            </div>

            <div class="sheet-kaeau">
                <input class="sheet-rond sheet-ka" name="attr_kaeau" type="number" />
                <button type="roll" class="sheet-karoll" style="color:rgb(51, 87, 88)" name="karolleau" value="&{template:ka} {{perso= @{character_name} }} {{nom_ka=Ka Eau}} {{jet=[[ 1d100 ]] }}{{seuil=[[(?{Bonus / malus ?|0}[ Bonus, malus, vécus, etc. ]+@{kaeau}[ Ka eau ])*10 ]] }} ">Ka Eau</button>
            </div>

            <div class="sheet-kalune">
                <input class="sheet-rond sheet-ka" name="attr_kalune" type="number" />
                <button type="roll" class="sheet-karoll" style="color:black" name="karolllune" value="&{template:ka} {{perso= @{character_name} }} {{nom_ka=Ka Lune}} {{jet=[[ 1d100 ]] }}{{seuil=[[(?{Bonus / malus ?|0}[ Bonus, malus, vécus, etc. ]+@{kalune}[ Ka lune ])*10 ]] }} ">Ka Lune</button>
            </div>

            <div class="sheet-katerre">
                <input class="sheet-rond sheet-ka" name="attr_katerre" type="number" />
                <button type="roll" class="sheet-karoll" style="color:#0e240e" name="karollterre" value="&{template:ka} {{perso= @{character_name} }} {{nom_ka=Ka Terre}} {{jet=[[ 1d100 ]] }}{{seuil=[[(?{Bonus / malus ?|0}[ Bonus, malus, vécus, etc. ]+@{katerre}[ Ka terre ])*10 ]] }} ">Ka Terre</button>
            </div>
            
            <div class="sheet-header"><img src="https://raw.githubusercontent.com/fennelin/roll20-character-sheets/master/Nephilim-Legende/images/nephilim.png"/></div>
        </div>

        <div class="sheet-box">

            <div class="sheet-attrib">
                <div class="sheet-bigtext">Points de sapience : </div><input class="sheet-carre" name="attr_sapience" type="number" />

            </div>
            <div class="sheet-box sheet-attrib">
                <h1>Chutes</h1>
                <div class="sheet-details-chutes">
                    <span class="sheet-petit">Kaiba</span>
                    <input type="number" class="sheet-carre sheet-floatright" name="attr_kaiba">
                    <div class="sheet-right">
                        <input type="radio" class="sheet-compteur sheet-zero" name="attr_kaiba" value="0" /><span></span>
                        <input type="radio" class="sheet-compteur" name="attr_kaiba" value="1" /><span></span>
                        <input type="radio" class="sheet-compteur" name="attr_kaiba" value="2" /><span></span>
                        <input type="radio" class="sheet-compteur" name="attr_kaiba" value="3" /><span></span>
                        <input type="radio" class="sheet-compteur" name="attr_kaiba" value="4" /><span></span>
                        <input type="radio" class="sheet-compteur" name="attr_kaiba" value="5" /><span></span>
                        <input type="radio" class="sheet-compteur" name="attr_kaiba" value="6" /><span></span>
                        <input type="radio" class="sheet-compteur" name="attr_kaiba" value="7" /><span></span>
                        <input type="radio" class="sheet-compteur" name="attr_kaiba" value="8" /><span></span>
                        <input type="radio" class="sheet-compteur" name="attr_kaiba" value="9" /><span></span>
                        <input type="radio" class="sheet-compteur" name="attr_kaiba" value="10" /><span></span>
                    </div>
                    <input type="text" name="attr_kaiba_form" placeholder="Forme" />
                </div>

                <div class="sheet-details-chutes">
                    <span class="sheet-petit">Narcose</span>
                    <input type="number" class="sheet-carre sheet-floatright" name="attr_narcose">
                    <span class="sheet-right">
                        <input type="radio" class="sheet-compteur sheet-zero" name="attr_narcose" value="0" /><span></span>
                        <input type="radio" class="sheet-compteur" name="attr_narcose" value="1" /><span></span>
                        <input type="radio" class="sheet-compteur" name="attr_narcose" value="2" /><span></span>
                        <input type="radio" class="sheet-compteur" name="attr_narcose" value="3" /><span></span>
                        <input type="radio" class="sheet-compteur" name="attr_narcose" value="4" /><span></span>
                        <input type="radio" class="sheet-compteur" name="attr_narcose" value="5" /><span></span>
                        <input type="radio" class="sheet-compteur" name="attr_narcose" value="6" /><span></span>
                        <input type="radio" class="sheet-compteur" name="attr_narcose" value="7" /><span></span>
                        <input type="radio" class="sheet-compteur" name="attr_narcose" value="8" /><span></span>
                        <input type="radio" class="sheet-compteur" name="attr_narcose" value="9" /><span></span>
                        <input type="radio" class="sheet-compteur" name="attr_narcose" value="10" /><span></span>
                    </span>
                    <input type="text" name="attr_narcose_form" placeholder="Lieu" />
                </div>

                <div class="sheet-details-chutes">
                    <span class="sheet-petit">Ombre</span>
                    <input type="number" class="sheet-carre sheet-floatright" name="attr_ombre">
                    <span class="sheet-right">
                        <input type="radio" class="sheet-compteur sheet-zero" name="attr_ombre" value="0" /><span></span>
                        <input type="radio" class="sheet-compteur" name="attr_ombre" value="1" /><span></span>
                        <input type="radio" class="sheet-compteur" name="attr_ombre" value="2" /><span></span>
                        <input type="radio" class="sheet-compteur" name="attr_ombre" value="3" /><span></span>
                        <input type="radio" class="sheet-compteur" name="attr_ombre" value="4" /><span></span>
                        <input type="radio" class="sheet-compteur" name="attr_ombre" value="5" /><span></span>
                        <input type="radio" class="sheet-compteur" name="attr_ombre" value="6" /><span></span>
                        <input type="radio" class="sheet-compteur" name="attr_ombre" value="7" /><span></span>
                        <input type="radio" class="sheet-compteur" name="attr_ombre" value="8" /><span></span>
                        <input type="radio" class="sheet-compteur" name="attr_ombre" value="9" /><span></span>
                        <input type="radio" class="sheet-compteur" name="attr_ombre" value="10" /><span></span>
                    </span>
                </div>
            </div>

            <div class="sheet-attrib sheet-main">
                <h1>Stase</h1>
                <div class="sheet-stase">
                    <input type="text" name="attr_stase_name" title="Objet de stase" placeholder="Objet de stase" />
                    <input class="sheet-carre" name="attr_simu-attr_stase_degre" type="number" />
                </div>
            </div>

            <div class="sheet-attrib sheet-main">
                <h1>Arcane</h1>
                <div class="sheet-stase">
                    <input type="text" name="attr_arc_name" title="Quête d'Arcane" placeholder="Quête d'Arcane" />
                    <input class="sheet-carre" name="attr_simu-attr_arc_degre" type="number" /><button type="roll" class="sheet-rolldice btn ui-draggable" name="sheet-simu-roll-vecu" style="color: rgb( 51 , 87 , 88 )" value="&amp;{template:vecu} {{perso= @{character_name} }} {{nom_vecu= @{arc_name} }} {{jet=[[ 1d100 ]] }}{{seuil=[[(?{ Bonus / malus ?|0}[ Bonus, malus, vécus, etc. ]+@{simu-attr_arc_degre}[ Vécu ])*10 ]] }} "></button>
                </div>
            </div>

        </div>
    </div>
</div>


<!------------------------------------------- Page 2 - Incarnation & Simulacre ------------------------------------------->

<div class="sheet-tab-content sheet-tab2">
    
    <div class="sheet-main sheet-attrib sheet-incarnation">
        <h3>Simulacre</h3>
        <div class="sheet-simu-attrib">
            <div class="sheet-bigtext">Ka soleil : </div>
            <input class="sheet-carre" name="attr_simu-kasoleil" type="number" />
        </div>
        <div class="sheet-simu-attrib">
            <div class="sheet-bigtext">Nom : </div>
            <input type="text" name="attr_simu_name" placeholder="Nom" />
            <div class="sheet-bigtext">Âge : </div>
            <input type="text" name="attr_simu_age" placeholder="Âge" />
        </div>
        <div class="sheet-simu-attrib">
            <div class="sheet-bigtext">Genre : </div>
            <input type="text" name="attr_simu_genre" placeholder="Genre" />
            <div class="sheet-bigtext">Vécu : </div>
            <input type="text" name="attr_simu_vecu" />
            <input class="sheet-carre" name="attr_simu-vecu-nbr" type="number" />
            <button type="roll" class="sheet-rolldice btn ui-draggable" name="sheet-simu-roll-vecu" style="color: rgb( 51 , 87 , 88 )" value="&amp;{template:vecu} {{perso= @{character_name} }} {{nom_vecu= @{simu_vecu} }} {{jet=[[ 1d100 ]] }}{{seuil=[[(?{ Bonus / malus ?|0}[ Bonus, malus, vécus, etc. ]+@{simu-vecu-nbr}[ Vécu ])*10 ]] }} "></button>
        </div>
        <div class="sheet-simu-attrib">
            <div class="sheet-bigtext sheet-text-top">Description : </div>
            <textarea rows="4" name="attr_simu-descr" placeholder="Description du simulacre"></textarea>
            <div class="sheet-bigtext sheet-text-top">Ressources : </div>
            <textarea rows="4" name="attr_simu-ress" placeholder="Ressources du simulacre"></textarea>
        </div>
        <div class="sheet-simu-attrib">
            <div class="sheet-bigtext sheet-text-top">Proches : </div>
            <textarea rows="4" name="attr_simu-proches" placeholder="Proches du simulacre"></textarea>
        </div>
    </div>

    <div class="sheet-main sheet-attrib sheet-incarnation">
        <h3>Périodes d'incarnation</h3>
        <h3>Vécus passés</h3>
        <fieldset class="repeating_epoques-incarnation">
            <div class="sheet-box sheet-col">
                <select class="sheet-large sheet-epoques-incarnation" name="attr_epoque">
                    <option value="0">-- Incarnation --</option>
                    <option value="chute-atlantide">La Chute de l'Atlantide</option>
                    <option value="deluge">Le Déluge</option>
                    <option value="premiers-dieux">Les premiers dieux</option>
                    <option value="premiers-peuple">Le premier peuple</option>
                    <option value="premiere-cite">La première cité</option>
                    <option value="premiers-megalithes">Les premiers mégalithes</option>
                    <option value="thuatha-danann">Les Tuatha de Danann</option>
                    <option value="mahabharata">Le Mahabharata</option>
                    <option value="labyrinthe-minos">Le labyrinthe de Minos</option>
                    <option value="reve-akhenathon">Le rêve d'Akhenathon</option>
                    <option value="chute-troie">La Chute de Troie</option>
                    <option value="empire-perse">L'empire perse</option>
                    <option value="empire-babylone">L'empire de Babylone</option>
                    <option value="empire-lexandre">L'empire d'Alexandre</option>
                    <option value="empire-carthage">L'empire de Carthage</option>
                    <option value="empire-rome">L'empire de Rome</option>
                    <option value="incident-jesus">L'incident Jésus</option>
                    <option value="arthuriades">Les Arthuriades</option>
                    <option value="croisades">Les croisades</option>
                    <option value="buchers-cathares">Les bûchers cathares</option>
                    <option value="chute-temple">La chute du Temple</option>
                    <option value="arcanes-renaissance">Les arcanes de la Renaissance</option>
                    <option value="secret-porte">Les secrets de la Sublime Porte</option>
                    <option value="cour-roi-soleil">La cour du Roi-Soleil</option>
                    <option value="conspiration-revolution">Les conspirations de la Révolution</option>
                    <option value="vapeurs-victoriennes">Les vapeurs victoriennes</option>
                    <option value="secession-viennoise">La Sécession viennoise</option>
                    <option value="anness-folles">Les années folles</option>
                    <option value="annees-noires">Les années noires</option>
                    <option value="eveil">L'Eveil</option>
                    <option value="chroniques-apocalypse">Les Chroniques de l'Apocalypse</option>
                </select>
            </div>
            <div class="sheet-box sheet-col">
                <input type="text" name="attr_vecus-passe1" type="text" /><input class="sheet-carre" name="attr_degres_vecu_passe1" type="number" />
                <button type="roll" class="sheet-rolldice btn ui-draggable" name="sheet-simu-roll-vecu" style="color: rgb( 51 , 87 , 88 )" value="&amp;{template:vecu} {{perso= @{character_name} }} {{nom_vecu= @{vecus-passe1} }} {{jet=[[ 1d100 ]] }}{{seuil=[[(?{ Bonus / malus ?|0}[ Bonus, malus, vécus, etc. ]+@{degres_vecu_passe1}[ Vécu ])*10 ]] }} "></button>
            </div>
            <div class="sheet-box sheet-col">
                <input type="text" name="attr_vecus-passe2" type="text" /><input class="sheet-carre" name="attr_degres_vecu_passe2" type="number" />
                <button type="roll" class="sheet-rolldice btn ui-draggable" name="sheet-simu-roll-vecu" style="color: rgb( 51 , 87 , 88 )" value="&amp;{template:vecu} {{perso= @{character_name} }} {{nom_vecu= @{vecus-passe2} }} {{jet=[[ 1d100 ]] }}{{seuil=[[(?{ Bonus / malus ?|0}[ Bonus, malus, vécus, etc. ]+@{degres_vecu_passe2}[ Vécu ])*10 ]] }} "></button>
            </div>
        </fieldset>
    </div>

    <div class="sheet-main sheet-quetes-savoirs">
        <div class="sheet-box sheet-attrib">
            <h3>Quetes esotériques</h3>
            <fieldset class="repeating_quetes-eso">
                <select class="sheet-large sheet-epoques-incarnation" name="attr_quete_eso">
                    <option value="0">-- Quête --</option>
                    <option value="arcadia">Arcadia</option>
                    <option value="arcane-xxi">Arcane XXI</option>
                    <option value="arche-alliance">Arche d'Alliance</option>
                    <option value="atalante-fugitive">Atalante fugitive</option>
                    <option value="champs-polemoka">Champs Polemoka</option>
                    <option value="cite-vertiges">Cité des Vertiges</option>
                    <option value="exode-sideral">Exode sidéral</option>
                    <option value="hyperborée">Hyperborée</option>
                    <option value="jerusalem-celest">Jérusalem céleste</option>
                    <option value="sentier-or">Le Sentier d'or</option>
                    <option value="porte-noire">Porte noire</option>
                    <option value="graal">Quête du Graal</option>
                    <option value="rex-mundi">Rex Mundi</option>
                    <option value="table-emeraude">Table d'émeraude</option>
                    <option value="toison-or">Toison d'or</option>
                    <option value="tresor-templiers">Trésor des Templiers</option>
                </select>
                <input class="sheet-carre" name="attr_quete_eso_degres" type="number" />
                <button type="roll" class="sheet-rolldice btn ui-draggable" name="sheet-simu-roll-vecu" style="color: rgb( 51 , 87 , 88 )" value="&amp;{template:vecu} {{perso= @{character_name} }} {{nom_vecu= @{quete_eso} }} {{jet=[[ 1d100 ]] }}{{seuil=[[(?{ Bonus / malus ?|0}[ Bonus, malus, vécus, etc. ]+@{quete_eso_degres}[ Quête ])*10 ]] }} "></button>
            </fieldset>
        </div>

        <div class="sheet-box sheet-attrib">
            <h3>Savoirs esotériques</h3>
            <fieldset class="repeating_savoir-eso">
                <select class="sheet-large sheet-epoques-incarnation" name="attr_savoir_eso">
                    <option value="0">-- Savoir --</option>
                    <option value="666">666</option>
                    <option value="akasha">Akasha</option>
                    <option value="ar-kaim">Ar-Kaïm</option>
                    <option value="arcanes-majeur">Arcanes majeurs</option>
                    <option value="bohemiens">Bohémiens</option>
                    <option value="champs-magiques">Champs magiques</option>
                    <option value="cousins">Cousins</option>
                    <option value="drakaon">Drakaon</option>
                    <option value="effets-dragons">Effets-dragons</option>
                    <option value="histoire-invisible">Histoire invisible</option>
                    <option value="kaim">Kaïm</option>
                    <option value="lune-noire">Lune Noire</option>
                    <option value="mystères">Mystères</option>
                    <option value="nephilim">Nephilim</option>
                    <option value="orichalque">Orichalque</option>
                    <option value="révélation">Révélation</option>
                    <option value="rose-croix">Rose+Croix</option>
                    <option value="sciences-occultes">Sciences-occultes</option>
                    <option value="selenim">Selenim</option>
                    <option value="synarchie">Synarchie</option>
                    <option value="templiers">Templiers</option>
                </select>
                <input class="sheet-carre" name="attr_savoir_eso_degres" title="degres" type="number" />
                <button type="roll" class="sheet-rolldice btn ui-draggable" name="sheet-simu-roll-vecu" style="color: rgb( 51 , 87 , 88 )" value="&amp;{template:vecu} {{perso= @{character_name} }} {{nom_vecu= @{savoir_eso} }} {{jet=[[ 1d100 ]] }}{{seuil=[[(?{ Bonus / malus ?|0}[ Bonus, malus, vécus, etc. ]+@{savoir_eso_degres}[ Savoir ])*10 ]] }} "></button>
            </fieldset>
        </div>
    </div>
</div>



<!------------------------------------------- Page 3 - Attributs & Dommages ------------------------------------------->

<div class="sheet-tab-content sheet-tab3">

    <div class="sheet-main sheet-attributes">
        <div class="sheet-col sheet-carac">
            <h2>Actions et attributs</h2>
            <div class="sheet-attrib">
                <div class="sheet-bigtext sheet-longtext">Initiative</div><input type="hidden" name="attr_foo_init" value="0" />
                <input type="number" name="attr_init" class="sheet-carre" title="ka-eau x2" value="@{foo_init}" disabled="true"/>
            </div>
            <div class="sheet-attrib">
                <div class="sheet-bigtext sheet-longtext">Mouvement</div><input type="hidden" name="attr_foo_mouv" value="0" />
                <input type="number" name="attr_mouv" class="sheet-carre" title="ka-eau x2" value="@{foo_mouv}" disabled="true"/>
            </div>
            <div class="sheet-attrib">
                <div class="sheet-bigtext sheet-longtext">Perspicacité</div><input type="hidden" name="attr_foo_persp" value="0" />
                <input type="number" name="attr_persp" class="sheet-carre" title="11 - ka-air" value="@{foo_persp}" disabled="true" />
            </div>
            <div class="sheet-attrib">
                <div class="sheet-bigtext sheet-longtext">Récupération</div><input type="hidden" name="attr_foo_recup" value="0" />
                <input type="number" name="attr_recup" class="sheet-carre" title="11 - ka-terre" value="@{foo_recup}" disabled="true" />
            </div>
            <div class="sheet-attrib">
                <div class="sheet-bigtext sheet-longtext">Bonus de dommages</div><input type="hidden" name="attr_foo_bonus-dom" value="0" />
                <input type="number" name="attr_bonus-dom" class="sheet-carre" title="(ka-feu>4 =+1)(ka-feu>9 =+2)" value="@{foo_bonus-dom}" disabled="true" />
            </div>
            <div class="sheet-attrib">
                <div class="sheet-bigtext sheet-longtext">Voile</div><input type="hidden" name="attr_foo_voile" value="0" />
                <input type="number" name="attr_voile" class="sheet-carre" title="(ka-lune>4 =1)(ka-lune>9 =2)" value="@{foo_voile}" disabled="true" />
            </div>
        </div>

        <div class="sheet-col sheet-main">
            <h2>Dommages</h2>
            <div class="sheet-attrib">
                <div class="sheet-dommages-physiques">
                    <div class="sheet-bigtext">Physiques</div>
                    <input type="number" class="sheet-carre sheet-floatright" name="attr_dom" />
                    <div class="sheet-right">
                        <input class="sheet-foo-dom-phys1" type="hidden" name="attr_foo_dom_phys1" value="0" />
                        <input class="sheet-foo-dom-phys2" type="hidden" name="attr_foo_dom_phys2" value="0" />
                        <input type="radio" class="sheet-compteur sheet-zero" name="attr_dom" value="0" readonly/><span></span>
                        <input type="radio" class="sheet-compteur" name="attr_dom" value="1" readonly /><span></span>
                        <input type="radio" class="sheet-compteur" name="attr_dom" value="2" readonly/><span></span>
                        <input type="radio" class="sheet-compteur" name="attr_dom" value="3" readonly/><span></span>
                        <input type="radio" class="sheet-compteur sheet-input-dom-phys-level4" name="attr_dom" value="4" readonly/><span class="sheet-dom-phys-level4"></span>
                        <input type="radio" class="sheet-compteur sheet-input-dom-phys-level5" name="attr_dom" value="5" readonly/><span class="sheet-dom-phys-level5"></span>
                    </div>
                </div>
            </div>

            <div class="sheet-attrib sheet-consequence">
                <div><div class="sheet-bigtext">Conséquences</div></div>
                <div class="sheet-line ">
                    <div class="sheet-bigtext sheet-100">Mineur</div><div class="sheet-bigtext sheet-modif">-2</div>
                    <label class="sheet-checkbox-label">
                        <input type="checkbox" name="attr_cons-min" class="sheet-checkbox-check">
                        <i class="sheet-checkbox-img"></i>
                    </label>
                    <input type="text" class="sheet-right" name="attr_cons-min-desc" /></span>
                </div>
                <div class="sheet-line ">
                    <div class="sheet-bigtext sheet-100">Sérieuse</div><div class="sheet-bigtext sheet-modif">-4</div>
                    <label class="sheet-checkbox-label">
                        <input type="checkbox" name="attr_cons-ser" class="sheet-checkbox-check">
                        <i class="sheet-checkbox-img"></i>
                    </label>
                    <input type="text" name="attr_cons-ser-desc" />
                </div>
                <div class="sheet-line ">
                    <div class="sheet-bigtext sheet-100">Grave</div><div class="sheet-bigtext sheet-modif">-6</div>
                    <label class="sheet-checkbox-label">
                        <input type="checkbox" name="attr_cons-gra" class="sheet-checkbox-check">
                        <i class="sheet-checkbox-img"></i>
                    </label>
                    <input type="text" name="attr_cons-gra-desc" />
                </div>
            </div>
        </div>

        <div class="sheet-col sheet-main">
            <h2>Dommages</h2>

            <div class="sheet-attrib">
                <div class="sheet-dommages-magiques">
                    <div class="sheet-bigtext">Magiques</div>
                    <input type="number" class="sheet-carre sheet-floatright" name="attr_dom-mag" />
                    <div class="sheet-right">
                        <input type="radio" class="sheet-compteur sheet-zero" name="attr_dom-mag" value="0" readonly/><span></span>
                        <input type="radio" class="sheet-compteur" name="attr_dom-mag" value="1" readonly/><span></span>
                        <input type="radio" class="sheet-compteur" name="attr_dom-mag" value="2" readonly/><span></span>
                        <input type="radio" class="sheet-compteur" name="attr_dom-mag" value="3" readonly/><span></span>
                    </div>
                </div>
            </div>

            <div class="sheet-attrib sheet-consequence">
                <div><div class="sheet-bigtext">Conséquences</div></div>
                <div class="sheet-line ">
                    <div class="sheet-bigtext sheet-100">Mineur</div><div class="sheet-bigtext sheet-modif">-2</div>
                    <label class="sheet-checkbox-label">
                        <input type="checkbox" name="attr_cons-mag-min" class="sheet-checkbox-check">
                        <i class="sheet-checkbox-img"></i>
                    </label>
                    <input type="text" name="attr_cons-mag-min-desc" />
                </div>
                <div class="sheet-line">
                    <div class="sheet-bigtext sheet-100">Sérieuse</div><div class="sheet-bigtext sheet-modif">-4</div>
                    <label class="sheet-checkbox-label">
                        <input type="checkbox" name="attr_cons-mag-ser" class="sheet-checkbox-check">
                        <i class="sheet-checkbox-img"></i>
                    </label>
                    <input type="text" name="attr_cons-mag-ser-desc" />
                </div>
                <div class="sheet-line">
                    <div class="sheet-bigtext sheet-100">Grave</div><div class="sheet-bigtext sheet-modif">-6</div>
                    <label class="sheet-checkbox-label">
                        <input type="checkbox" name="attr_cons-mag-gra" class="sheet-checkbox-check">
                        <i class="sheet-checkbox-img"></i>
                    </label>
                    <input type="text" name="attr_cons-mag-gra-desc" />
                </div>
            </div>
            <input type="hidden" name="attr_total-malus" />
        </div>
    </div>
    
    <div class="sheet-main sheet-attrib">
        <h2>Possessions</h2>

        <div class="sheet-box sheet-attrib sheet-posses">
            <div><div class="sheet-bigtext">Armes</div></div>
            <fieldset class="repeating_poss-arme">
                <input type="text" name="attr_poss-arme-nom" placeholder="Nom de l'arme"/>
                <input class="sheet-carre sheet-floatright" name="attr_poss-arme-degre" type="number" />
            </fieldset>
        </div>

        <div class="sheet-box sheet-attrib sheet-posses">
            <div><div class="sheet-bigtext">Protections</div></div>
            <fieldset class="repeating_poss-protec">
                <input type="text" name="attr_poss-protec-nom" placeholder="Nom de la protection"/>
                <input class="sheet-carre sheet-floatright" name="attr_poss-protec-degre" type="number" />
            </fieldset>
        </div>

        <div class="sheet-box sheet-attrib sheet-posses sheet-posses-artef">
            <div><div class="sheet-bigtext">Artefacts</div></div>
            <fieldset class="repeating_posse-artefact-eso">
                <input type="text" name="attr_poss-artefact-name" placeholder="Nom de l'artefact"/>
                <select class="sheet-poss-artef-ka" name="attr_poss-artefact-ka">
                    <option value="0">-- Ka-élément --</option>
                    <option value="kaair">Air</option>
                    <option value="kaeau">Eau</option>
                    <option value="kafeu">Feu</option>
                    <option value="kalune">Lune</option>
                    <option value="katerre">Terre</option>
                </select>
                <input class="sheet-carre sheet-floatright" name="attr_poss-artefact-score" type="number" />
                <textarea name="attr_poss-artefact-def" placeholder="Description de l'artefact"></textarea>
            </fieldset>
        </div>
    </div>
</div>


<!------------------------------------------- Page 4 - Magie ------------------------------------------->
<div class="sheet-tab-content sheet-tab4">
    <div class="sheet-main sheet-attrib sheet-magie-main">
        <h2>Magie</h2>
        <div class="sheet-ligne">
            <div class="sheet-bigtext">Basse Magie</div><input type="number" name="attr_mag-basse-degre" class="sheet-carre" />
            <div class="sheet-bigtext">Haute Magie</div><input type="number" name="attr_mag-haute-degre" class="sheet-carre" />
            <div class="sheet-bigtext">Grand secret</div><input type="number" name="attr_mag-secret-degre" class="sheet-carre" />
        </div>
        <div class="sheet-ligne">
            <div class="sheet-bigtext">Voie initiatique</div>
            <select class="sheet-large sheet-epoques-incarnation" name="attr_mag-voie">
                <option value="0" selected>-- Voie initiatique --</option>
                <option value="sentier-sinueux">Sentier sinueux</option>
                <option value="spirale-elevation">Spirale d'élèvation</option>
                <option value="principe-egarants">Principes égarants</option>
                <option value="labyrinthe-ame">Labyrinthe schématique</option>
                <option value="dedale-ame">Dédale de l'âme</option>
            </select>
            <div class="sheet-bigtext">Etape</div>
            <select class="sheet-large sheet-epoques-incarnation" name="attr_mag-etape">
                <option value="0">-- Etape --</option>
                <option value="porche">Porche</option>
                <option value="carrefour">Carrefour</option>
                <option value="coeur">Coeur</option>
                <option value="fil">Fil</option>
                <option value="epreuve">Epreuve</option>
            </select>
        </div>
    </div>
    <div class="sheet-main sheet-attrib sheet-magie-main">
        <h2>Liste de sorts</h2>
        <fieldset class="repeating_mag-sort">
            <div class="sheet-mag-sort-spec">
                <div class="sheet-ligne">
                    <div class="sheet-bigtext">Nom : </div><input type="text" class="sheet-longinputtext sheet-firstinput" name="attr_mag-sort-nom" /> <button type="roll" class="sheet-rolldice btn ui-draggable" name="sheet-simu-roll-vecu" style="color: rgb( 51 , 87 , 88 )" value="&amp;{template:sort} {{perso= @{character_name} }} {{nom_sort= @{mag-sort-nom} }} {{descrip_sort= @{mag-sort-desc} }} {{portee_sort= @{mag-sort-portee} }} {{duree_sort= @{mag-sort-duree} }} {{degre= @{mag-sort-degre} }} {{jet=[[ 1d100 ]] }}{{seuil=[[(?{Bonus / malus ?|0}[ Bonus, malus, vécus, etc. ]+@{mag-sort-current}[ Magie + Ka - Degré ])*10 ]] }} "></button>
                </div>
                <div class="sheet-ligne">
                    <div class="sheet-bigtext">Voie : </div>
                    <select class="sheet-mag-sort-voie" name="attr_mag-sort-voie">
                        <option value="0">-- Voie --</option>
                        <option value="sentier-sinueux">Sentier sinueux</option>
                        <option value="spirale-elevation">Spirale d'élèvation</option>
                        <option value="principe-egarants">Principes égarants</option>
                        <option value="labyrinthe-ame">Labyrinthe schématique</option>
                        <option value="dedale-ame">Dédale de l'âme</option>
                    </select>
                    <div class="sheet-bigtext">Etape : </div>
                    <select class="sheet-mag-sort-etape" name="attr_mag-sort-etape">
                        <option value="0">-- Etape --</option>
                        <option value="porche">Porche</option>
                        <option value="carrefour">Carrefour</option>
                        <option value="coeur">Coeur</option>
                        <option value="fil">Fil</option>
                        <option value="epreuve">Epreuve</option>
                    </select>
                </div>
                <div class="sheet-ligne">
                    <div class="sheet-bigtext">Ka-élément : </div>
                    <select class="sheet-mag-sort-ka" name="attr_mag-sort-ka">
                        <option value="0">-- Ka --</option>
                        <option value="kaair">Air</option>
                        <option value="kaeau">Eau</option>
                        <option value="kafeu">Feu</option>
                        <option value="kalune">Lune</option>
                        <option value="katerre">Terre</option>
                    </select>
                    <div class="sheet-bigtext">Cercle : </div>
                    <select class="sheet-mag-sort-ka" name="attr_mag-sort-cercle">
                        <option value="0">-- Cercle --</option>
                        <option value="mag-basse-degre">Basse magie</option>
                        <option value="mag-haute-degre">Haute magie</option>
                        <option value="mag-secret-degre">Grand secret</option>
                    </select>
                </div>        
                <div class="sheet-ligne">
                    <div class="sheet-bigtext">Portée : </div><input type="text" class="sheet-longinputtext" name="attr_mag-sort-portee" />
                    <div class="sheet-bigtext">Durée : </div><input type="text" class="sheet-longinputtext" name="attr_mag-sort-duree" />
                </div>
                <div class="sheet-ligne sheet-mag-number">
                    <div class="sheet-bigtext">Degré : </div><input type="number" name="attr_mag-sort-degre" class="sheet-carre" />
                    <div class="sheet-bigtext">Difficulté : </div><input type="number" name="attr_mag-sort-current-false" class="sheet-carre" value="@{mag-sort-current}" disabled="true" />
                    <input type="hidden" value="0" name="attr_mag-sort-current">
                </div>
                <div class="sheet-ligne sheet-last-line">
                    <div class="sheet-bigtext">Description : </div>
                    <textarea name="attr_mag-sort-desc"></textarea>
                </div>
            </div>
        </fieldset>        
    </div>
</div>


<!------------------------------------- Page 5 : Kabbale - Généralités & invocations ------------------------------------->
<div class="sheet-tab-content sheet-tab5">
    <div class="sheet-main sheet-attrib sheet-kabb-main">
        <h2>Kabbale  - Généralités</h2>
        <div class="sheet-ligne">
            <div class="sheet-bigtext">Monde</div>
            <select class="sheet-large sheet-epoques-incarnation" name="attr_kabb-monde">
                <option value="0">-- Monde --</option>
                <option value="sohar">Sohar</option>
                <option value="zakaï">Zakaï</option>
                <option value="pachad">Pachad</option>
                <option value="meborack">Meborack</option>
                <option value="aresh">Aresh</option>
            </select>
        </div>
        <h2>Ordonnances</h2>
        <div class="sheet-ligne">
            <div class="sheet-col3 sheet-col-first">
                <div class="sheet-col-titre">Degré</div>
            </div>
            <div class="sheet-col3">
                <div class="sheet-col-titre">Nom</div>
            </div>
            <div class="sheet-col3  sheet-col-last">
                <div class="sheet-col-titre">Respectée ?</div>
            </div>
        </div>
        
        <fieldset class="repeating_kabb-ord">
            <div class="sheet-ligne">
                <div class="sheet-col3 sheet-col-first">
                    <input type="number" class="sheet-carre" name="attr_kabb-ord-degré" value="0"/>
                </div>
                <div class="sheet-col3">
                    <input type="text" class="sheet-verylonginputtext" name="attr_kabb-ord-nom" placeholder="Nom de l'ordonnance"/>
                </div>
                <div class="sheet-col3  sheet-col-last">
                    <label class="sheet-checkbox-label">
                        <input type="checkbox" name="attr_kabb-ord-respect" class="sheet-checkbox-check">
                        <i class="sheet-checkbox-img"></i>
                    </label>
                </div>
            </div>
        </fieldset>
    </div>
    <div class="sheet-main sheet-attrib">
        <h2>Liste des invocations</h2>
        <fieldset class="repeating_kabb-invoc">
            <div class="sheet-kabb-invoc-spec">
                <div class="sheet-ligne">
                    <div class="sheet-bigtext">Nom : </div><input type="text" class="sheet-longinputtext sheet-firstinput" name="attr_kabb-invoc-nom" /> <button type="roll" class="sheet-rolldice btn ui-draggable" name="sheet-simu-roll-vecu" style="color: rgb( 51 , 87 , 88 )" value="&amp;{template:invoc} {{perso= @{character_name} }} {{nom_creature= @{kabb-invoc-nom} }} {{descrip_sort= @{kabb-invoc-desc} }} {{portee_sort= @{kabb-invoc-portee} }} {{duree_sort= @{kabb-invoc-duree} }} {{degre= @{kabb-invoc-degre} }} {{jet=[[ 1d100 ]] }}{{seuil=[[(?{Bonus / malus ?|0}[ Bonus, malus, vécus, etc. ]+@{kabb-invoc-current}[ Kabbale + Ka ])*10 ]] }} "></button><button type="roll" class="sheet-rollsword btn ui-draggable" name="sheet-simu-roll-opposition" style="color: rgb( 51 , 87 , 88 )" value="&amp;{template:opposition} {{perso= @{character_name} }} {{nom_creature= @{kabb-invoc-nom} }} {{jet=[[ 1d100 ]] }} {{seuil=[[(?{Bonus / malus ?|0}[Bonus, malus, vécus, etc. ]+@{kabb-invoc-current}[ Kabbale + Ka ])*10 ]] }} {{jet_degre=[[ 1d100 ]] }} {{niv-degre=[[@{kabb-invoc-degre}[ Degré ]*10 ]] }}"></button>
                </div>
                <div class="sheet-ligne">
                    <div class="sheet-bigtext">Sephira : </div>
                    <select class="sheet-kabb-invoc-sephira" name="attr_kabb-invoc-sephira">
                        <option value="0">-- Sephira --</option>
                        <option value="malkut">Malkut</option>
                        <option value="yesod">Yesod</option>
                        <option value="hod">Hod</option>
                        <option value="netzah">Netzah</option>
                        <option value="tiphereth">Tiphereth</option>
                        <option value="chesed">Chesed</option>
                        <option value="geburah">Geburah</option>
                        <option value="binah">Binah</option>
                        <option value="hokmah">Hokmah</option>
                        <option value="kheter">Kheter</option>
                    </select>
                    <div class="sheet-bigtext">Monde : </div>
                    <select class="sheet-kabb-invoc-monde" name="attr_kabb-invoc-monde">
                        <option value="0">-- Monde --</option>
                        <option value="sohar">Sohar</option>
                        <option value="zakaï">Zakaï</option>
                        <option value="pachad">Pachad</option>
                        <option value="meborack">Meborack</option>
                        <option value="aresh">Aresh</option>
                    </select>
                </div>
                <div class="sheet-ligne">
                    <div class="sheet-bigtext">Ka-élément : </div>
                    <select class="sheet-kabb-invoc-ka" name="attr_kabb-invoc-ka">
                        <option value="0">-- Ka --</option>
                        <option value="kaair">Air</option>
                        <option value="kaeau">Eau</option>
                        <option value="kafeu">Feu</option>
                        <option value="kalune">Lune</option>
                        <option value="katerre">Terre</option>
                    </select>
                    <div class="sheet-bigtext">Visibilité : </div>
                    <label class="sheet-checkbox-label">
                        <input type="checkbox" name="attr_kabb-invoc-visible" class="sheet-checkbox-check">
                        <i class="sheet-checkbox-img"></i>
                    </label>
                </div>        
                <div class="sheet-ligne">
                    <div class="sheet-bigtext">Portée : </div><input type="text" class="sheet-longinputtext" name="attr_kabb-invoc-portee" />
                    <div class="sheet-bigtext">Durée : </div><input type="text" class="sheet-longinputtext" name="attr_kabb-invoc-duree" />
                </div>
                <div class="sheet-ligne sheet-mag-number">
                    <div class="sheet-bigtext">Degré : </div><input type="number" name="attr_kabb-invoc-degre" class="sheet-carre" />
                    <div class="sheet-bigtext">Difficulté : </div><input type="number" name="attr_kabb-invoc-current-false" class="sheet-carre" value="@{kabb-invoc-current}" disabled="true" />
                    <input type="hidden" value="0" name="attr_kabb-invoc-current">
                </div>
                <div class="sheet-ligne sheet-last-line">
                    <div class="sheet-bigtext">Description : </div>
                    <textarea name="attr_kabb-invoc-desc"></textarea>
                </div>
            </div>
        </fieldset>
    </div>
</div>

<!------------------------------------- Page 6 : Kabbale - Arbre ------------------------------------->
<div class="sheet-tab-content sheet-tab6">
    <div class="sheet-main sheet-attrib">
        <h1>Arbre de la Kabbale</h1>
    </div>
    <div class="sheet-main sheet-kabb-arbre">
        <div class="sheet-kabb-arbre-spec sheet-kabb-arbre-kheter"><input class="sheet-rond sheet-kabb-arbre-monde" type="number" name="attr_kheter" /></div>
        <div class="sheet-kabb-arbre-spec sheet-kabb-arbre-binah"><input class="sheet-rond sheet-kabb-arbre-monde" type="number" name="attr_binah" /></div>
        <div class="sheet-kabb-arbre-spec sheet-kabb-arbre-hokmah"><input class="sheet-rond sheet-kabb-arbre-monde" type="number" name="attr_hokmah" /></div>
        <div class="sheet-kabb-arbre-spec sheet-kabb-arbre-geburah"><input class="sheet-rond sheet-kabb-arbre-monde" type="number" name="attr_geburah" /></div>
        <div class="sheet-kabb-arbre-spec sheet-kabb-arbre-tiphereth"><input class="sheet-rond sheet-kabb-arbre-monde" type="number" name="attr_tiphereth" /></div>
        <div class="sheet-kabb-arbre-spec sheet-kabb-arbre-chesed"><input class="sheet-rond sheet-kabb-arbre-monde" type="number" name="attr_chesed" /></div>
        <div class="sheet-kabb-arbre-spec sheet-kabb-arbre-hod"><input class="sheet-rond sheet-kabb-arbre-monde" type="number" name="attr_hod" /></div>
        <div class="sheet-kabb-arbre-spec sheet-kabb-arbre-yesod"><input class="sheet-rond sheet-kabb-arbre-monde" type="number" name="attr_yesod" /></div>
        <div class="sheet-kabb-arbre-spec sheet-kabb-arbre-netzah"><input class="sheet-rond sheet-kabb-arbre-monde" type="number" name="attr_netzah" /></div>
        <div class="sheet-kabb-arbre-spec sheet-kabb-arbre-malkut"><input class="sheet-rond sheet-kabb-arbre-monde" type="number" name="attr_malkut" /></div>
    </div>
</div>

<!------------------------------------- Page 7 : Alchimie - Généralités & formules ------------------------------------->
<div class="sheet-tab-content sheet-tab7">
    <div class="sheet-main sheet-attrib sheet-alch-main">
        <h2>Alchimie</h2>
        <div class="sheet-ligne">
            <div class="sheet-bigtext">Oeuvre au noir</div><input type="number" name="attr_alch-oeuvre-noir" class="sheet-carre" />
            <div class="sheet-bigtext">Oeuvre au blanc</div><input type="number" name="attr_alch-oeuvre-blanc" class="sheet-carre" />
            <div class="sheet-bigtext">Oeuvre au rouge</div><input type="number" name="attr_alch-oeuvre-rouge" class="sheet-carre" />
        </div>
        <div class="sheet-ligne">
            <div class="sheet-bigtext">Voie : </div>
            <select class="sheet-large sheet-epoques-incarnation" name="attr_alch-voie">
                <option value="0">-- Voie --</option>
                <option value="breve">Voie brève</option>
                <option value="seche">Voie sèche</option>
                <option value="humide">Voie humide</option>
                <option value="royale">Voie royale</option>
                <option value="pagirie">Spagirie</option>
            </select>
        </div>
        <h2>Constructs utilisés</h2>
        <div class="sheet-ligne">
            <div class="sheet-alch-construct-use">
                <div class="sheet-col-titre-construct">Athanor</div>
                <label class="sheet-checkbox-label">
                    <input type="checkbox" name="attr_alch-athanor-use" class="sheet-checkbox-check">
                    <i class="sheet-checkbox-img"></i>
                </label>
            </div>

            <div class="sheet-alch-construct-use">
                <div class="sheet-col-titre-construct">Creuset</div>
                <label class="sheet-checkbox-label">
                    <input type="checkbox" name="attr_alch-creuset-use" class="sheet-checkbox-check">
                    <i class="sheet-checkbox-img"></i>
                </label>
            </div>
            
            <div class="sheet-alch-construct-use">
                <div class="sheet-col-titre-construct">Cornue</div>
                <label class="sheet-checkbox-label">
                    <input type="checkbox" name="attr_alch-cornue-use" class="sheet-checkbox-check">
                    <i class="sheet-checkbox-img"></i>
                </label>
            </div>
            
            <div class="sheet-alch-construct-use">
                <div class="sheet-col-titre-construct">Alambic</div>
                <label class="sheet-checkbox-label">
                    <input type="checkbox" name="attr_alch-alambic-use" class="sheet-checkbox-check">
                    <i class="sheet-checkbox-img"></i>
                </label>
            </div>
            
            <div class="sheet-alch-construct-use">
                <div class="sheet-col-titre-construct">Aludel</div>
                <label class="sheet-checkbox-label">
                    <input type="checkbox" name="attr_alch-aludel-use" class="sheet-checkbox-check">
                    <i class="sheet-checkbox-img"></i>
                </label>
            </div>

        </div>
    </div>
    <div class="sheet-main sheet-attrib sheet-alch-main">
        <h2>Liste des Materias Primae</h2>
        <div class="sheet-ligne">
            <div class="sheet-alch-mp"><div class="sheet-alch-mp-eau"></div> : <input type="number" name="attr_alch-mp-eau" class="sheet-carre" />/<input type="number" name="attr_alch-mp-eau-max" class="sheet-carre" /></div>
            <div class="sheet-alch-mp"><div class="sheet-alch-mp-air"></div> : <input type="number" name="attr_alch-mp-air" class="sheet-carre" />/<input type="number" name="attr_alch-mp-air-max" class="sheet-carre" /></div>
            <div class="sheet-alch-mp"><div class="sheet-alch-mp-feu"></div> : <input type="number" name="attr_alch-mp-feu" class="sheet-carre" />/<input type="number" name="attr_alch-mp-feu-max" class="sheet-carre" /></div>
            <div class="sheet-alch-mp"><div class="sheet-alch-mp-terre"></div> : <input type="number" name="attr_alch-mp-terre" class="sheet-carre" />/<input type="number" name="attr_alch-mp-terre-max" class="sheet-carre" /></div>
            <div class="sheet-alch-mp"><div class="sheet-alch-mp-lune"></div> : <input type="number" name="attr_alch-mp-lune" class="sheet-carre" />/<input type="number" name="attr_alch-mp-lune-max" class="sheet-carre" /></div>
        </div>
    </div>
    <div class="sheet-main sheet-attrib sheet-alch-main">
        <h2>Liste des formules</h2>
        <fieldset class="repeating_alch-form">
            <div class="sheet-alch-form-spec">
                <div class="sheet-ligne">
                    <div class="sheet-bigtext">Nom : </div><input type="text" class="sheet-longinputtext sheet-firstinput" name="attr_alch-form-nom" /> <button type="roll" class="sheet-rolldice btn ui-draggable" name="sheet-simu-roll-vecu" style="color: rgb( 51 , 87 , 88 )" value="&amp;{template:formule} {{perso= @{character_name} }} {{nom_formule= @{alch-form-nom} }} {{nb_materia= @{alch-form-degre} }} {{jet=[[ 1d100 ]] }}{{seuil=[[(?{Bonus / malus ?|0}[ Bonus, malus, vécus, etc. ]+@{alch-form-current}[ Alchimie + Construct - Degré ])*10 ]] }} "></button>
                </div>
                <div class="sheet-ligne">
                    <div class="sheet-bigtext">Enoncé : </div><input type="text" class="sheet-longinputtext sheet-secondinput" name="attr_alch-form-enonce" />
                </div>
                <div class="sheet-ligne">
                    <div class="sheet-bigtext">Art occulte : </div>
                    <select class="sheet-alch-form-art" name="attr_alch-form-art">
                        <option value="0">-- Art occulte --</option>
                        <option value="alch-oeuvre-noir">Oeuvre au noir</option>
                        <option value="alch-oeuvre-blanc">Oeuvre au blanc</option>
                        <option value="alch-oeuvre-rouge">Oeuvre au rouge</option>
                    </select>
                    <div class="sheet-bigtext">Substance : </div>
                    <select class="sheet-alch-form-subs" name="attr_alch-form-subs">
                        <option value="0" selected>-- Substance --</option>
                        <option value="alch-athanor">Poudre (Athanor)</option>
                        <option value="alch-creuset">Métal (Creuset)</option>
                        <option value="alch-cornue">Ambre (Cornue)</option>
                        <option value="alch-alambic">Liqueur (Alambic)</option>
                        <option value="alch-aludel">Vapeur (Aludel)</option>
                    </select>
                </div>
                <div class="sheet-ligne">
                    <div class="sheet-bigtext">Ka-élément 1 : </div>
                    <select class="sheet-alch-form-ka-1" name="attr_alch-form-ka-1">
                        <option value="0">-- Ka --</option>
                        <option value="kaair">Air</option>
                        <option value="kaeau">Eau</option>
                        <option value="kafeu">Feu</option>
                        <option value="kalune">Lune</option>
                        <option value="katerre">Terre</option>
                    </select>
                    <div class="sheet-bigtext">Ka-élément 2 : </div>
                    <select class="sheet-alch-form-ka-2" name="attr_alch-form-ka-2">
                        <option value="0">-- Ka --</option>
                        <option value="kaair">Air</option>
                        <option value="kaeau">Eau</option>
                        <option value="kafeu">Feu</option>
                        <option value="kalune">Lune</option>
                        <option value="katerre">Terre</option>
                    </select>
                </div>
                <div class="sheet-ligne">
                    <div class="sheet-bigtext">Aire d'effet : </div><input type="text" class="sheet-longinputtext" name="attr_alch-form-portee" />
                    <div class="sheet-bigtext">Durée : </div><input type="text" class="sheet-longinputtext" name="attr_alch-form-duree" />
                </div>
                <div class="sheet-ligne sheet-mag-number">
                    <div class="sheet-bigtext">Degré : </div><input type="number" name="attr_alch-form-degre" class="sheet-carre" />
                    <div class="sheet-bigtext">Difficulté : </div><input type="number" name="attr_alch-form-current-false" class="sheet-carre" value="@{alch-form-current}" disabled="true" />
                    <input type="hidden" value="0" name="attr_alch-form-current">
                </div>
                <div class="sheet-ligne sheet-last-line">
                    <div class="sheet-bigtext">Description : </div>
                    <textarea name="attr_alch-form-desc"></textarea>
                </div>
            </div>
        </fieldset>        
    </div>
</div>


<!------------------------------------- Page 8 : Alchimie - construct ------------------------------------->
<div class="sheet-tab-content sheet-tab8">
    <div class="sheet-main sheet-attrib">
        <h1>Constructs alchimique</h1>
    </div>
    <div class="sheet-ligne">
        <div class="sheet-main sheet-alch-construct sheet-alch-construct-athanor">
            <div class="sheet-alch-construct-spec sheet-alch-construct-spec-athanor-kafeu"><input class="sheet-rond sheet-alch-construct-ka" type="number" name="attr_alch-athanor-kafeu" /></div>
            <div class="sheet-alch-construct-spec sheet-alch-construct-spec-athanor-katerre"><input class="sheet-rond sheet-alch-construct-ka" type="number" name="attr_alch-athanor-katerre" /></div>
            <div class="sheet-alch-construct-spec sheet-alch-construct-spec-athanor-kaair"><input class="sheet-rond sheet-alch-construct-ka" type="number" name="attr_alch-athanor-kaair" /></div>
            <div class="sheet-alch-construct-spec sheet-alch-construct-spec-athanor-kalune"><input class="sheet-rond sheet-alch-construct-ka" type="number" name="attr_alch-athanor-kalune" /></div>
            <div class="sheet-alch-construct-spec sheet-alch-construct-spec-athanor-kaeau"><input class="sheet-rond sheet-alch-construct-ka" type="number" name="attr_alch-athanor-kaeau" /></div>
        </div>
        <div class="sheet-main sheet-alch-construct sheet-alch-construct-alambic">
            <div class="sheet-alch-construct-spec sheet-alch-construct-spec-alambic-kafeu"><input class="sheet-rond sheet-alch-construct-ka" type="number" name="attr_alch-alambic-kafeu" /></div>
            <div class="sheet-alch-construct-spec sheet-alch-construct-spec-alambic-katerre"><input class="sheet-rond sheet-alch-construct-ka" type="number" name="attr_alch-alambic-katerre" /></div>
            <div class="sheet-alch-construct-spec sheet-alch-construct-spec-alambic-kaair"><input class="sheet-rond sheet-alch-construct-ka" type="number" name="attr_alch-alambic-kaair" /></div>
            <div class="sheet-alch-construct-spec sheet-alch-construct-spec-alambic-kalune"><input class="sheet-rond sheet-alch-construct-ka" type="number" name="attr_alch-alambic-kalune" /></div>
            <div class="sheet-alch-construct-spec sheet-alch-construct-spec-alambic-kaeau"><input class="sheet-rond sheet-alch-construct-ka" type="number" name="attr_alch-alambic-kaeau" /></div>
        </div>
        <div class="sheet-main sheet-alch-construct sheet-alch-construct-creuset">
            <div class="sheet-alch-construct-spec sheet-alch-construct-spec-creuset-kafeu"><input class="sheet-rond sheet-alch-construct-ka" type="number" name="attr_alch-creuset-kafeu" /></div>
            <div class="sheet-alch-construct-spec sheet-alch-construct-spec-creuset-katerre"><input class="sheet-rond sheet-alch-construct-ka" type="number" name="attr_alch-creuset-katerre" /></div>
            <div class="sheet-alch-construct-spec sheet-alch-construct-spec-creuset-kaair"><input class="sheet-rond sheet-alch-construct-ka" type="number" name="attr_alch-creuset-kaair" /></div>
            <div class="sheet-alch-construct-spec sheet-alch-construct-spec-creuset-kalune"><input class="sheet-rond sheet-alch-construct-ka" type="number" name="attr_alch-creuset-kalune" /></div>
            <div class="sheet-alch-construct-spec sheet-alch-construct-spec-creuset-kaeau"><input class="sheet-rond sheet-alch-construct-ka" type="number" name="attr_alch-creuset-kaeau" /></div>
        </div>
    </div>
    <div class="sheet-ligne">
        <div class="sheet-main sheet-alch-construct sheet-alch-construct-cornue">
            <div class="sheet-alch-construct-spec sheet-alch-construct-spec-cornue-kafeu"><input class="sheet-rond sheet-alch-construct-ka" type="number" name="attr_alch-cornue-kafeu" /></div>
            <div class="sheet-alch-construct-spec sheet-alch-construct-spec-cornue-katerre"><input class="sheet-rond sheet-alch-construct-ka" type="number" name="attr_alch-cornue-katerre" /></div>
            <div class="sheet-alch-construct-spec sheet-alch-construct-spec-cornue-kaair"><input class="sheet-rond sheet-alch-construct-ka" type="number" name="attr_alch-cornue-kaair" /></div>
            <div class="sheet-alch-construct-spec sheet-alch-construct-spec-cornue-kalune"><input class="sheet-rond sheet-alch-construct-ka" type="number" name="attr_alch-cornue-kalune" /></div>
            <div class="sheet-alch-construct-spec sheet-alch-construct-spec-cornue-kaeau"><input class="sheet-rond sheet-alch-construct-ka" type="number" name="attr_alch-cornue-kaeau" /></div>
        </div>
        <div class="sheet-main sheet-alch-construct sheet-alch-construct-aludel">
            <div class="sheet-alch-construct-spec sheet-alch-construct-spec-aludel-kafeu"><input class="sheet-rond sheet-alch-construct-ka" type="number" name="attr_alch-aludel-kafeu" /></div>
            <div class="sheet-alch-construct-spec sheet-alch-construct-spec-aludel-katerre"><input class="sheet-rond sheet-alch-construct-ka" type="number" name="attr_alch-aludel-katerre" /></div>
            <div class="sheet-alch-construct-spec sheet-alch-construct-spec-aludel-kaair"><input class="sheet-rond sheet-alch-construct-ka" type="number" name="attr_alch-aludel-kaair" /></div>
            <div class="sheet-alch-construct-spec sheet-alch-construct-spec-aludel-kalune"><input class="sheet-rond sheet-alch-construct-ka" type="number" name="attr_alch-aludel-kalune" /></div>
            <div class="sheet-alch-construct-spec sheet-alch-construct-spec-aludel-kaeau"><input class="sheet-rond sheet-alch-construct-ka" type="number" name="attr_alch-aludel-kaeau" /></div>
        </div>
    </div>
</div>

<!------------------------------------- Page 9 : Fraternité ------------------------------------->
<div class="sheet-tab-content sheet-tab9">
    <div class="sheet-main sheet-attrib">
        <h2>Descriptions</h2>
        <div class="sheet-ligne">
            <div><div class="sheet-bigtext">Nom : </div><input type="text" class="sheet-longinputtext" name="attr_frat-nom" /></div>
            <div><div class="sheet-bigtext">Quête : </div><input type="text" class="sheet-longinputtext" name="attr_frat-quete" /><input type="number" class="sheet-carre" name="attr_frat-quete-score" /></div>
        </div>
    </div>
    
    <div class="sheet-main sheet-attrib sheet-descr">
        <h2>Ressources</h2>
        <div class="sheet-ligne">
            <div class="sheet-bigtext">Ressources propres : </div>
            <fieldset class="repeating_frat-ress-propr">
                <input type="text" class="sheet-longinputtext" name="attr_frat-ress-propr" />
            </fieldset>
        </div>
        <div class="sheet-ligne">
            <div class="sheet-bigtext">Alliés : </div>
            <fieldset class="repeating_frat-ress-allies">
                <input type="text" class="sheet-longinputtext" name="attr_frat-ress-allies" />
            </fieldset>
        </div>
        <div class="sheet-ligne">
            <div class="sheet-bigtext">Refuges : </div>
            <fieldset class="repeating_frat-ress-refuge">
                <input type="text" class="sheet-longinputtext" name="attr_frat-ress-refuge" />
            </fieldset>
        </div>
    </div>

</div>


<!------------------------------------- End HTML Page ------------------------------------->




<!------------------------------------- Begin Roll Templates ------------------------------------->
<!------------------------------------- Ka-Roll Template ------------------------------------->

<rolltemplate class="sheet-rolltemplate-ka">
    <div class="sheet-dice-box sheet-bg-ka">
        <h1>{{perso}}</h1>
        <div class="sheet-dice-subheader">Utilisation du {{nom_ka}}</div>
        <div class="sheet-dice-main">
            <div class="sheet-dice-roll">Résultat du jet :<br />{{jet}} ( {{seuil}} )</div>
        
            {{#rollLess() seuil jet}}
                    <div class="sheet-dice-result-ko">Echec</div>
            {{/rollLess() seuil jet}}
            
            {{#rollGreater() seuil jet}}
                    <div class="sheet-dice-result-ok">Réussite</div>
            {{/rollGreater() seuil jet}}
            {{#rollTotal() seuil jet}}
                    <div class="sheet-dice-result-ok">Réussite</div>
            {{/rollTotal() seuil jet}}
		</div>
    </div>
</rolltemplate>

<!------------------------------------- Vecu-Roll Template ------------------------------------->
<rolltemplate class="sheet-rolltemplate-vecu">
    <div class="sheet-dice-box sheet-bg-vecu">
        <h1>{{perso}}</h1>
        <div class="sheet-dice-subheader">
            <div>Mobilise son expérience de :</div>
            <div><span class="sheet-dice-bold">{{nom_vecu}}</span></div>
        </div>
        <div class="sheet-dice-main">
            <div class="sheet-dice-roll">
                <div>Résultat du jet :</div>
                <div>{{jet}} ( {{seuil}} )</div>
            </div>
        
            {{#rollLess() seuil jet}}
                    <div class="sheet-dice-result-ko">Echec</div>
            {{/rollLess() seuil jet}}
            
            {{#rollGreater() seuil jet}}
                    <div class="sheet-dice-result-ok">Réussite</div>
            {{/rollGreater() seuil jet}}
            {{#rollTotal() seuil jet}}
                    <div class="sheet-dice-result-ok">Réussite</div>
            {{/rollTotal() seuil jet}}
        </div>
    </div>
</rolltemplate>

<!------------------------------------- Ka-Roll Template ------------------------------------->
<rolltemplate class="sheet-rolltemplate-ka">
    <div class="sheet-dice-box sheet-bg-ka">
        <h1>{{perso}}</h1>
        <div class="sheet-dice-subheader">
            <div>Utilise son :</div>
            <div><span class="sheet-dice-bold">{{nom_ka}}</span></div>
        </div>
        <div class="sheet-dice-main">
            <div class="sheet-dice-roll">
                <div>Résultat du jet :</div>
                <div>{{jet}} ( {{seuil}} )</div>
            </div>
        
            {{#rollLess() seuil jet}}
                    <div class="sheet-dice-result-ko">Echec</div>
            {{/rollLess() seuil jet}}
            
            {{#rollGreater() seuil jet}}
                    <div class="sheet-dice-result-ok">Réussite</div>
            {{/rollGreater() seuil jet}}
            {{#rollTotal() seuil jet}}
                    <div class="sheet-dice-result-ok">Réussite</div>
            {{/rollTotal() seuil jet}}
        </div>
    </div>
</rolltemplate>

<!------------------------------------- Sort-Roll Template ------------------------------------->
<rolltemplate class="sheet-rolltemplate-sort">
    <div class="sheet-dice-box sheet-bg-sort">
        <h1>{{perso}}</h1>
        <div class="sheet-dice-subheader">
            <div>Lance le sort : </div>
            <div><span class="sheet-dice-bold">{{nom_sort}} ( {{degre}} )</span></div>
        </div>

        <div class="sheet-dice-main">
            <div class="sheet-dice-roll">
                <div>Résultat du jet :</div>
                <div>{{jet}} ( {{seuil}} )</div>
            </div>
        
            {{#rollLess() seuil jet}}
                    <div class="sheet-dice-result-ko">Echec</div>
            {{/rollLess() seuil jet}}
            
            {{#rollGreater() seuil jet}}
                    <div class="sheet-dice-result-ok">Réussite</div>
                    <div class="sheet-dice-effect">
                        <div><span class="sheet-dice-bold">Portée : </span>{{portee_sort}}</div>
                        <div><span class="sheet-dice-bold">Durée : </span>{{duree_sort}}</div>
                        <div><span class="sheet-dice-bold">Effet : </span>{{descrip_sort}}</div>
                    </div>
            {{/rollGreater() seuil jet}}
            {{#rollTotal() seuil jet}}
                    <div class="sheet-dice-result-ok">Réussite</div>
                    <div class="sheet-dice-effect">
                        <div><span class="sheet-dice-bold">Portée : </span>{{portee_sort}}</div>
                        <div><span class="sheet-dice-bold">Durée : </span>{{duree_sort}}</div>
                        <div><span class="sheet-dice-bold">Effet : </span>{{descrip_sort}}</div>
                    </div>
            {{/rollTotal() seuil jet}}
        </div>
    </div>
</rolltemplate>

<!------------------------------------- Invocation-Roll Template ------------------------------------->
<rolltemplate class="sheet-rolltemplate-invoc">
    <div class="sheet-dice-box sheet-bg-invoc">
        <h1>{{perso}}</h1>
        <div class="sheet-dice-subheader">
            <div>Invoque la créature : </div>
            <div><span class="sheet-dice-bold">{{nom_creature}} ( {{degre}} )</span></div>
        </div>

        <div class="sheet-dice-main">
            <div class="sheet-dice-roll">
                <div>Résultat du jet :</div>
                <div>{{jet}} ( {{seuil}} )</div>
            </div>
        
            {{#rollLess() seuil jet}}
                    <div class="sheet-dice-result-ko">Echec</div>
            {{/rollLess() seuil jet}}
            
            {{#rollGreater() seuil jet}}
                    <div class="sheet-dice-result-ok">Réussite</div>
                    <div class="sheet-dice-effect">
                        <div><span class="sheet-dice-bold">Portée : </span>{{portee_sort}}</div>
                        <div><span class="sheet-dice-bold">Durée : </span>{{duree_sort}}</div>
                        <div><span class="sheet-dice-bold">Effet : </span>{{descrip_sort}}</div>
                    </div>
            {{/rollGreater() seuil jet}}
            {{#rollTotal() seuil jet}}
                    <div class="sheet-dice-result-ok">Réussite</div>
                    <div class="sheet-dice-effect">
                        <div><span class="sheet-dice-bold">Portée : </span>{{portee_sort}}</div>
                        <div><span class="sheet-dice-bold">Durée : </span>{{duree_sort}}</div>
                        <div><span class="sheet-dice-bold">Effet : </span>{{descrip_sort}}</div>
                    </div>
            {{/rollTotal() seuil jet}}
        </div>
    </div>
</rolltemplate>

<!------------------------------------- Opposition-Roll Template ------------------------------------->
<rolltemplate class="sheet-rolltemplate-opposition">
    <div class="sheet-dice-box sheet-bg-opposition">
        <h1>{{perso}}</h1>
        <div class="sheet-dice-subheader">
            <div>Veut signer un contrat avec : </div>
            <div><span class="sheet-dice-bold">{{nom_creature}}</span></div>
        </div>
        <div class="sheet-dice-main">

            <!------ Personnage ------>
            <div class="sheet-dice-col2">
                <div class="sheet-dice-ligne">{{perso}}</div>
                <div class="sheet-dice-ligne">{{jet}}</div>
                <div class="sheet-dice-ligne">
                    {{#rollLess() seuil jet}}
                            <div class="sheet-dice-result-ko">Echec</div>
                    {{/rollLess() seuil jet}}
                    
                    {{#rollGreater() seuil jet}}
                            <div class="sheet-dice-result-ok">Réussite</div>
                    {{/rollGreater() seuil jet}}

                    {{#rollTotal() seuil jet}}
                            <div class="sheet-dice-result-ok">Réussite</div>
                    {{/rollTotal() seuil jet}}
                </div>
            </div>

            <div class="sheet-dice-col-inter"><span class="sheet-dice-bold">VS</span></div>
            
            <!------ Creature ------>
            <div class="sheet-dice-col2">
                <div class="sheet-dice-ligne">{{nom_creature}}</div>
                <div class="sheet-dice-ligne">{{jet_degre}}</div>
                <div class="sheet-dice-ligne">
                    {{#rollLess() niv-degre jet_degre}}
                            <div class="sheet-dice-result-ko">Echec</div>
                    {{/rollLess() niv-degre jet_degre}}
                    
                    {{#rollGreater() niv-degre jet_degre}}
                            <div class="sheet-dice-result-ok">Réussite</div>
                    {{/rollGreater() niv-degre jet_degre}}

                    {{#rollTotal() niv-degre jet_degre}}
                            <div class="sheet-dice-result-ok">Réussite</div>
                    {{/rollTotal() niv-degre jet_degre}}
                </div>
            </div>
        </div>
    </div>
</rolltemplate>

<!------------------------------------- Formules-Roll Template ------------------------------------->
<rolltemplate class="sheet-rolltemplate-formule">
    <div class="sheet-dice-box sheet-bg-formule">
        <h1>{{perso}}</h1>
        <div class="sheet-dice-subheader">
            <div>Transmute la substance : </div>
            <div><span class="sheet-dice-bold">{{nom_formule}}</span></div>
        </div>
        <div class="sheet-dice-main">
            <div class="sheet-dice-roll">
                <div>Résultat du jet :</div>
                <div>{{jet}} ( {{seuil}} )</div>
            </div>
            <!------ Personnage ------>
            {{#rollLess() seuil jet}}
                    <div class="sheet-dice-result-ko">Echec</div>
            {{/rollLess() seuil jet}}
            
            {{#rollGreater() seuil jet}}
                    <div class="sheet-dice-result-ok">Réussite</div>
            {{/rollGreater() seuil jet}}
            {{#rollTotal() seuil jet}}
                    <div class="sheet-dice-result-ok">Réussite</div>
            {{/rollTotal() seuil jet}}
            
            <div class="sheet-dice-effect">
                Cela utilise <span class="sheet-dice-bold">{{nb_materia}} Materia Primae</span> par élément
            </div>
        </div>
    </div>
</rolltemplate>

<!------------------------------------- End Roll Templates ------------------------------------->


<!------------------------------------- End custom sheet here ------------------------------------->

 

<!------------------------------------- Begin Sheet Workers ------------------------------------->
 <script type="text/worker">

    /********************** Calculs lors des MaJ des Ka-Elements **********************/
    on("change:katerre change:kaeau change:kaair change:kafeu change:kalune", function() {
        getAttrs(["kaeau", "kafeu", "katerre", "kaair", "kalune", ], function(values) {
            const katerre = parseInt(values.katerre);
            const kaeau = parseInt(values.kaeau);
            const kaair = parseInt(values.kaair);
            const kafeu = parseInt(values.kafeu);
            const kalune = parseInt(values.kalune);

            const output = {};

            // Mise à jour des caractéristiques généralles
            output['foo_init'] = kaeau * 2;
            output['foo_mouv'] = kaeau * 2;
            output['foo_persp'] = 11 - kaair;
            output['foo_recup'] = 11 - katerre;

            // Dommages physiques
            output['foo_dom_phys2'] = 0;
            output['foo_dom_phys1'] = 0;
            
            if (katerre >= 5) {
                output['foo_dom_phys1'] = 1;
            }
            if (katerre >= 10) {
                output['foo_dom_phys2'] = 1;
            }

            // Bonus dommages
            output['foo_bonus-dom'] = 0;

            if (kafeu >= 5 && kafeu < 10) {
                output['foo_bonus-dom'] = 1;
            } else if (kafeu >= 10 ) {
                output['foo_bonus-dom'] = 2;
            }

            // Voile
            output['foo_voile'] = 0;

            if (kalune >= 5 && kalune < 10) {
                output['foo_voile'] = 1;
            } else if (kalune >= 10 ) {
                output['foo_voile'] = 2;
            }

            // mise à jour des champs
            if(output) setAttrs(output);

            //Mise à jour de la magie
            updateMagieFromOutside();
            // mise à jour de la Kabbale
            updateKabbaleFromOutside();
        });
    });

    /********************** Calculs lors des Dommages magiques et physiques **********************/
    on("change:cons-min change:cons-ser change:cons-gra change:cons-mag-min change:cons-mag-ser change:cons-mag-gra", function() {
        getAttrs(["cons-min", "cons-ser", "cons-gra", "cons-mag-min", "cons-mag-ser", "cons-mag-gra"], function(values) {
            const output = {};
            output['total-malus'] = 0;

            // Si check alors cons_min = "on", on ajoute +2
            if (isNaN(parseInt(values["cons-min"]))) {
                output['total-malus'] += 2;
            }

            if (isNaN(parseInt(values["cons-ser"]))) {
                output['total-malus'] += 4;
            }

            if (isNaN(parseInt(values["cons-gra"]))) {
                output['total-malus'] += 6;
            }

            if (isNaN(parseInt(values["cons-mag-min"]))) {
                output['total-malus'] += 2;
            }

            if (isNaN(parseInt(values["cons-mag-ser"]))) {
                output['total-malus'] += 4;
            }

            if (isNaN(parseInt(values["cons-mag-gra"]))) {
                output['total-malus'] += 6;
            }

            // mise à jour des champs
            if(output) setAttrs(output);

        });
    });


    /********************** Calcul des sorts magiques du Nephilim dans la repating section **********************/

    on("change:repeating_mag-sort:mag-sort-ka change:repeating_mag-sort:mag-sort-degre change:repeating_mag-sort:mag-sort-cercle", function() {
        getAttrs([
        "repeating_mag-sort_mag-sort-ka", "repeating_mag-sort_mag-sort-degre", "repeating_mag-sort_mag-sort-cercle",
        "kaeau", "kafeu", "katerre", "kaair", "kalune", 
        "mag-basse-degre", "mag-haute-degre", "mag-secret-degre",
        ], function(values) {

            var ka_element = values["repeating_mag-sort_mag-sort-ka"];
            var ka_element_value = getIntValue(values[ka_element]);
           
            var mag_voie = values["repeating_mag-sort_mag-sort-cercle"];
            var mag_voie_value = getIntValue(values[mag_voie]);

            var degre = getIntValue(values["repeating_mag-sort_mag-sort-degre"]);

            var total = (ka_element_value + mag_voie_value) - degre;

            setAttrs({'repeating_mag-sort_mag-sort-current': total});
        });
    });

    /********************** Calcul des sorts magiques du Nephilim lors de l'update des score de basse/haute magie **********************/

    on("change:mag-basse-degre change:mag-haute-degre change:mag-secret-degre", function(eventInfo) {
        updateMagieFromOutside();
    });


    /********************** Calcul des invocation de Kabbale à l'update des invocations **********************/

    on("change:repeating_kabb-invoc:kabb-invoc-ka change:repeating_kabb-invoc:kabb-invoc-sephira", function() {
        getAttrs([
        "repeating_kabb-invoc_kabb-invoc-ka", "repeating_kabb-invoc_kabb-invoc-sephira",
        "kaeau", "kafeu", "katerre", "kaair", "kalune", 
        "malkut", "yesod", "hod", "netzah", "tiphereth", "chesed", "geburah", "binah", "hokmah", "kheter"
        ], function(values) {

            var ka_element = values["repeating_kabb-invoc_kabb-invoc-ka"];
            var ka_element_value = getIntValue(values[ka_element]);

            var kabb_sephira = values["repeating_kabb-invoc_kabb-invoc-sephira"];
            var kabb_sephira_value = getIntValue(values[kabb_sephira]);

            var total = (ka_element_value + kabb_sephira_value);

            setAttrs({'repeating_kabb-invoc_kabb-invoc-current': total});
        });
    });

    /********************** Calcul des invocations du Nephilim lors de l'update des scores des mondes de Kabbale **********************/

    on("change:malkut change:yesod change:hod change:netzah change:tiphereth change:chesed change:geburah change:binah change:hokmah change:kheter", function(eventInfo) {
        updateKabbaleFromOutside();        
    });

    
    /********************** Calcul des formules alchimiques du Nephilim dans la repating section **********************/

    on("change:repeating_alch-form:alch-form-art change:repeating_alch-form:alch-form-ka-1 change:repeating_alch-form:alch-form-ka-2 change:repeating_alch-form:alch-form-subs change:repeating_alch-form:alch-form-degre", function() {
        getAttrs([
        "repeating_alch-form_alch-form-art", "repeating_alch-form_alch-form-ka-1", "repeating_alch-form_alch-form-ka-2", "repeating_alch-form_alch-form-subs", "repeating_alch-form_alch-form-degre",
        "kaeau", "kafeu", "katerre", "kaair", "kalune", 
        "alch-oeuvre-noir", "alch-oeuvre-blanc", "alch-oeuvre-rouge",
        "alch-athanor-kafeu", "alch-athanor-kaeau", "alch-athanor-katerre", "alch-athanor-kalune", "alch-athanor-kaair",
        "alch-aludel-kafeu", "alch-aludel-kaeau", "alch-aludel-katerre", "alch-aludel-kalune", "alch-aludel-kaair",
        "alch-alambic-kafeu", "alch-alambic-kaeau", "alch-alambic-katerre", "alch-alambic-kalune", "alch-alambic-kaair",
        "alch-cornue-kafeu", "alch-cornue-kaeau", "alch-cornue-katerre", "alch-cornue-kalune", "alch-cornue-kaair",
        "alch-creuset-kafeu", "alch-creuset-kaeau", "alch-creuset-katerre", "alch-creuset-kalune", "alch-creuset-kaair",
        ], function(values) {

            // On récupère la valeur de la substance qui correspondt à l'id du construct
            var construct = values["repeating_alch-form_alch-form-subs"];
            var ka_element1 = values["repeating_alch-form_alch-form-ka-1"];
            var ka_element2 = values["repeating_alch-form_alch-form-ka-2"];

            // On construit l'id du ka concerné du construct sous la forme : "contruct-kaelement". Cela permet de récupérer la bonne valeur
            var ka_element_value1 = getIntValue(values[construct + "-" + ka_element1]);
            var ka_element_value2 = getIntValue(values[construct + "-" + ka_element2]);
           
            var alch_oeuvre = values["repeating_alch-form_alch-form-art"];
            var alch_oeuvre_value = getIntValue(values[alch_oeuvre]);
            var degre = getIntValue(values["repeating_alch-form_alch-form-degre"]);

            var total = (ka_element_value1 + ka_element_value2 + alch_oeuvre_value) - degre;

            setAttrs({'repeating_alch-form_alch-form-current': total});
        });
    });


    /********************** Calcul des formules alchimiques du Nephilim lors de l'update des scores des constructs **********************/

    on("change:alch-oeuvre-rouge change:alch-oeuvre-blanc change:alch-oeuvre-noir change:alch-creuset-kafeu change:alch-creuset-kaeau change:alch-creuset-katerre change:alch-creuset-kalune change:alch-creuset-kaair change:alch-cornue-kafeu change:alch-cornue-kaeau change:alch-cornue-katerre change:alch-cornue-kalune change:alch-cornue-kaair change:alch-alambic-kafeu change:alch-alambic-kaeau change:alch-alambic-katerre change:alch-alambic-kalune change:alch-alambic-kaair change:alch-athanor-kafeu change:alch-athanor-kaeau change:alch-athanor-katerre change:alch-athanor-kalune change:alch-athanor-kaair change:alch-aludel-kafeu change:alch-aludel-kaeau change:alch-aludel-katerre change:alch-aludel-kalune change:alch-aludel-kaair", function(eventInfo) {
        updateAlchimieFromOutside();
    });


    
    /********************** TODO : Change des ka element --> MaJ des propriétés des nephilim + magie + kabbale + alchimie **********************/

    /********************** Définition des fonctions utilitaires **********************/
    /*
     *  Fonction de mise à jour des sorts de magie lorsqu'un champs extérieur est utilisé
     */
     function updateMagieFromOutside(){
        getSectionIDs("repeating_mag-sort", function (idArray) {
            // Get an array of all the relevant row names, so we can getAttrs them
            const fieldKa = idArray.map(id => `repeating_mag-sort_${id}_mag-sort-ka`);
            const fieldCercle = idArray.map(id => `repeating_mag-sort_${id}_mag-sort-cercle`);
            const fieldDegre = idArray.map(id => `repeating_mag-sort_${id}_mag-sort-degre`);
            const otherValues = ["kaeau", "kafeu", "kaair", "katerre", "kalune", "mag-basse-degre", "mag-haute-degre", "mag-secret-degre"];

            var allfield = fieldKa.concat(fieldCercle).concat(fieldDegre).concat(otherValues);

            // Get all the attribute values.
            getAttrs(allfield, function (values) {
                // lets name the variable for setAttrs something unambigious so it can be confused with anything else:
                const output = {};

                for (let i = 0; i < idArray.length; i++) {
                    // Calculate the value. Use variable names that describe what the value actually is.
                    const thisRow_ka = values['repeating_mag-sort_' + idArray[i] + '_mag-sort-ka'];
                    const thisRow_cercle = values['repeating_mag-sort_' + idArray[i] + '_mag-sort-cercle'];
                    const thisRow_degre = values['repeating_mag-sort_' + idArray[i] + '_mag-sort-degre'];

                    var thisRow_ka_value = getIntValue(values[thisRow_ka]);
                    var thisRow_cercle_value = getIntValue(values[thisRow_cercle]);
                    var thisRow_degre_value = getIntValue(thisRow_degre);
                    
                    var thisRow_total = (thisRow_ka_value + thisRow_cercle_value) - thisRow_degre_value;

                    output['repeating_mag-sort_' + idArray[i] + '_mag-sort-current'] = thisRow_total;
                }
                if(output) setAttrs(output);
            });
        });
    }


    /*
     *  Fonction de mise à jour des invocations de Kabbale lorsqu'un champs extérieur est utilisé
     */
    function updateKabbaleFromOutside(){
        getSectionIDs("repeating_kabb-invoc", function (idArray) {
            // Get an array of all the relevant row names, so we can getAttrs them
            const fieldKa = idArray.map(id => `repeating_kabb-invoc_${id}_kabb-invoc-ka`);
            const fieldSephira = idArray.map(id => `repeating_kabb-invoc_${id}_kabb-invoc-sephira`);

            const otherValues = ["kaeau", "kafeu", "kaair", "katerre", "kalune", "malkut", "yesod", "netzah", "tiphereth", "chesed", "geburah", "binah", "hokmah", "kheter", "hod"];

            var allfield = fieldKa.concat(fieldSephira).concat(otherValues);

            // Get all the attribute values.
            getAttrs(allfield, function (values) {
                // lets name the variable for setAttrs something unambigious so it can be confused with anything else:
                const output = {};

                for (let i = 0; i < idArray.length; i++) {
                    // Calculate the value. Use variable names that describe what the value actually is.
                    const thisRow_ka = values['repeating_kabb-invoc_' + idArray[i] + '_kabb-invoc-ka'];
                    const thisRow_sephira = values['repeating_kabb-invoc_' + idArray[i] + '_kabb-invoc-sephira'];

                    var thisRow_ka_value = getIntValue(values[thisRow_ka]);
                    var thisRow_sephira_value = getIntValue(values[thisRow_sephira]);

                    var thisRow_total = (thisRow_ka_value + thisRow_sephira_value);

                    output['repeating_kabb-invoc_' + idArray[i] + '_kabb-invoc-current'] = thisRow_total;
                }
                if(output) setAttrs(output);
            });
        });
    }


    /*
     *  Fonction de mise à jour des formules d'alchimie lorsqu'un champs extérieur est utilisé
     */
    function updateAlchimieFromOutside(){
        getSectionIDs("repeating_alch-form", function (idArray) {
            // Get an array of all the relevant row names, so we can getAttrs them
            const fieldKa1 = idArray.map(id => `repeating_alch-form_${id}_alch-form-ka-1`);
            const fieldKa2 = idArray.map(id => `repeating_alch-form_${id}_alch-form-ka-2`);
            const fieldConstruct = idArray.map(id => `repeating_alch-form_${id}_alch-form-subs`);
            const fieldOeuvre = idArray.map(id => `repeating_alch-form_${id}_alch-form-art`);
            const fieldDegre = idArray.map(id => `repeating_alch-form_${id}_alch-form-degre`);

            const otherValues = ["kaeau", "kafeu", "kaair", "katerre", "kalune", "alch-oeuvre-noir", "alch-oeuvre-blanc", "alch-oeuvre-rouge"];
            const creuset = ["alch-creuset-kafeu", "alch-creuset-kaeau", "alch-creuset-katerre", "alch-creuset-kalune", "alch-creuset-kaair"];
            const alambic = ["alch-alambic-kafeu", "alch-alambic-kaeau", "alch-alambic-katerre", "alch-alambic-kalune", "alch-alambic-kaair"];
            const cornue = ["alch-cornue-kafeu", "alch-cornue-kaeau", "alch-cornue-katerre", "alch-cornue-kalune", "alch-cornue-kaair"];
            const athanor = ["alch-athanor-kafeu", "alch-athanor-kaeau", "alch-athanor-katerre", "alch-athanor-kalune", "alch-athanor-kaair"];
            const aludel = ["alch-aludel-kafeu", "alch-aludel-kaeau", "alch-aludel-katerre", "alch-aludel-kalune", "alch-aludel-kaair"];

            var allfield = fieldKa1.concat(fieldKa2).concat(fieldConstruct).concat(fieldOeuvre).concat(fieldDegre).concat(otherValues).concat(creuset).concat(alambic).concat(cornue).concat(athanor).concat(aludel);

            // Get all the attribute values.
            getAttrs(allfield, function (values) {
                // lets name the variable for setAttrs something unambigious so it can be confused with anything else:
                const output = {};

                for (let i = 0; i < idArray.length; i++) {

                    // On récupère la valeur de la substance qui correspondt à l'id du construct
                    var thisRow_construct = values['repeating_alch-form_' + idArray[i] + '_alch-form-subs'];
                    var thisRow_ka_element1 = values['repeating_alch-form_' + idArray[i] + '_alch-form-ka-1'];
                    var thisRow_ka_element2 = values['repeating_alch-form_' + idArray[i] + '_alch-form-ka-2'];

                    // On construit l'id du ka concerné du construct sous la forme : "contruct-kaelement". Cela permet de récupérer la bonne valeur
                    var thisRow_ka_element_value1 = getIntValue(values[thisRow_construct + "-" + thisRow_ka_element1]);
                    var thisRow_ka_element_value2 = getIntValue(values[thisRow_construct + "-" + thisRow_ka_element2]);
                
                    var thisRow_alch_oeuvre = values['repeating_alch-form_' + idArray[i] + '_alch-form-art'];
                    var thisRow_alch_oeuvre_value = getIntValue(values[thisRow_alch_oeuvre]);
                    var thisRow_degre = values['repeating_alch-form_' + idArray[i] + '_alch-form-degre'];

                    var thisRow_total = (thisRow_ka_element_value1 + thisRow_ka_element_value2 + thisRow_alch_oeuvre_value) - thisRow_degre;

                    output['repeating_alch-form_' + idArray[i] + '_alch-form-current'] = thisRow_total;
                }
                if(output) setAttrs(output);
            });
        });
    }

    /********************** Définition des fonctions génériques **********************/
    /**
    *  Fonction qui renvoie une valeur sous forme d'integer
    *  Return un entier ou 0
    **/
    function getIntValue(value) {
        if (!isEmpty(value)) {
            output = parseInt(value);
        } else {
            output = parseInt(0);
        }
        return output;
    }

    /**
    *  Fonction de vérification de variable undefined OU vide
    *  Return true si empty
    **/
    function isEmpty(str) {
        return (!str || 0 === str.length);
    }
    
</script>